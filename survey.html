<!--suciu@cs.stanford.edu wrote this, email him with questions-->
<!--Code is here: https://github.com/suciutwo/haas-survey-visualization-->
<!--I'm using d3.js to draw the radar chart -->
<!--since Qualtrics is a bit fussy, I decided to just stick a script in the html instead of fussing with a separate javascript file-->

<!--load d3-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.1/d3.min.js"></script>
<!--load jquery-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>
    var $j = jQuery.noConflict();
</script>


<!--using the d3 radar chart from https://github.com/alangrafu/radar-chart-d3-->
<link rel="stylesheet" type="text/css" href="css/radar-chart.css"/>
<script src="js/radar-chart.js" charset="utf-8"></script>

<!--Here's the html you need-->
<div style="text-align: left;">
    <p>Thank you for completing the Public Service Pathways Survey! Just ONE more step to complete...</p>
    <br>
    <p>Below, you will see a graphic visualization of your answers about the pathways.</p>
    <br>
    <p> It is important that you scroll to the bottom portion of your screen  AND click the button at the BOTTOM RIGHT CORNER of the page to submit your responses. </p>
    <br>
    <p> Regarding the graphic visualization below:</p>
    <br>
    <ul>
        <li>The large diagram at the top represents your inclination toward the various pathways overall. The position of each of the pathways on the diagram is random.</li>
        <li>The small diagrams represent:
            <ul>
                <li>the <b>Interest</b> you have in exploring the various pathways during college</li>
                <li>the <b>Experience</b> you have in the various pathways</li>
                <li>your self-perceived <b>Strength</b> in the various pathways</li>
                <li>the <b>Impact</b> you think the various pathways have on social issues</li>
            </ul>
        </li>
        <li>The points on the small diagrams represent the pathways at the corresponding points on the large diagram.</li>
    </ul>
    <br>
    <br>
    <br>
    <br>
</div>
<div class="chart"></div>

<script>

    /* Here's the part I wrote. This is the part you would change. */

    $j(document).ready(function() {

        var valueOfUserSelectedColumn = function (questionId, rownumber) {
            var idName;
            for (var columnNumber = 1; columnNumber <= 4; columnNumber++) {
                idName = '#QR\\~QID' + questionId + '\\~' + rownumber + '\\~' + columnNumber;
                if ($j(idName).prop('checked')) {
                    return columnNumber - 1;
                }
            }
            return 0;
        };

        var sumQuestion = function (questionId) {
            var sum = 0;
            for (var rowNumber = 1; rowNumber <= 4; rowNumber++) {
                sum += valueOfUserSelectedColumn(questionId, rowNumber);
            }
            return sum;
        };

        var activismQID = 24;
        var communityEngagedQID = 27;
        var directServiceQID = 28;
        var philanthropyQID = 29;
        var policyPoliticsQID = 30;
        var socialEntrepreneurshipQID = 31;
        var data = [
            {
                className: 'public-service-chart',
                axes: [
                    {axis: "Activism", value: sumQuestion(activismQID)},
                    {axis: "Community Engaged Learning and Research", value: sumQuestion(communityEngagedQID), xOffset: -40},
                    {axis: "Direct Service", value: sumQuestion(directServiceQID), xOffset: -18},
                    {axis: "Philanthropy", value: sumQuestion(philanthropyQID), yOffset: -2},
                    {axis: "Policy/Politics", value: sumQuestion(policyPoliticsQID), xOffset: 20},
                    {axis: "Social Entrepreneurship", value: sumQuestion(socialEntrepreneurshipQID), xOffset: 37}
                ]
            }
        ];

        var experience = genericStarChart("Experience", [1, 1, 1, 1, 1, 1]);
        var interest = genericStarChart("Interest",     [4, 4, 4, 4, 4, 4]);
        var strength = genericStarChart("Strength",     [2, 2, 2, 2, 2, 2]);
        var impact = genericStarChart("Impact",         [3, 3, 3, 3, 3, 3]);

        function genericStarChart(name, rowNumberArray) {
            return [
                {
                    className: 'public-service-chart',
                    axes: [
                        {axis: "", value: valueOfUserSelectedColumn(activismQID, rowNumberArray[0])},
                        {axis: "", value: valueOfUserSelectedColumn(communityEngagedQID,rowNumberArray[1]), xOffset: -40},
                        {axis: "", value: valueOfUserSelectedColumn(directServiceQID, rowNumberArray[2]), xOffset: -18},
                        {axis: name, value: valueOfUserSelectedColumn(philanthropyQID, rowNumberArray[3]), yOffset: -2},
                        {axis: "", value: valueOfUserSelectedColumn(policyPoliticsQID, rowNumberArray[4]), xOffset: 20},
                        {axis: "", value: valueOfUserSelectedColumn(socialEntrepreneurshipQID, rowNumberArray[5]), xOffset: 37}
                    ]
                }
            ];
        }

        var chart = RadarChart.chart();
        var cfg = chart.config(); // retrieve default config
        var svg = d3.select('.chart').append('svg')
                .attr('width', cfg.w)
                .attr('height', cfg.h + cfg.h / 4);
        chart.config({maxValue: 12});
        svg.append('g').classed('single', 1).datum(data).call(chart);

        chart.config({
            w: cfg.w / 4,
            h: cfg.h / 4,
            axisText: true,
            levels: 0,
            circles: false,
            maxValue: 3
        });
        cfg = chart.config();

        function render() {
            var game = svg.selectAll('g.game')
                .data([interest, experience, strength, impact]);
            game.enter()
                .append('g').classed('game', 1);
            game.attr('transform',
                function (d, i) {
                    return 'translate(' + (i * cfg.w) + ',' + (cfg.h * 4) + ')';
                }).call(chart);
        }
        render();

        // Hide the survey response summary header and all of the questions so that only the chart displays
        $j('#ResponseSummaryHeader').hide();   // header
        $j('.QuestionOuter').hide();           // all questions

        // Label the final button "Submit" instead of "Save & Continue"
        $j('#NextButton').attr('value', 'Submit');
    });



</script>
